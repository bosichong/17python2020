<div class="blog-article">
<h1 class="title">Django2.2.X用户内置的登录登出验证的方法与源码</h1>
<span class="author">J.sky</span>
<span class="time">2019-11-25 16:08:04</span>
<span class="tag">Django</span>
</div>
</br>

![输入图片说明](/assets/images/media/upload/2019/11/Snip20191125_1.png)

### 背景需求

使用Django开发一些网站的时候，我们需要利用Django实现快速的登录验证，Django提供了一系列的帮助，我们来看看如何实现。

### 配置与路由

配置urls.py中的登录与登出

        path('login', views.sitelogin, name='login'),
        path('logout', views.sitelogout, name="logout"),

settings.py中添加视图函数登录权限跳转要用

    LOGIN_URL="login" #（视图函数登录权限跳转要用）

### 视图与模板

视图views.py中的登录与登出函数


    def sitelogin(request):
        error_msg = ' '
        if request.method == "GET":
            return render(request, "app/login.html")
        if request.method == "POST":
            username = request.POST.get("username")
            print(username)
            password = request.POST.get("password")
            print(password)
            user = authenticate(username=username, password=password)  # 只是验证功能，还没有登录
    
            if user:
                print(user)  # username
                print(type(user))  # <class 'django.contrib.auth.models.User'>
                login(request, user)  # 验证通过，登录
                # 内部有request.user=user     可以用模板{{request.user}}
                return redirect(request.GET.get("next", '/app'))  # 登陆后跳转到首页
                # 登录成功默认跳转用户信息页面，如果是其他页面来的，登录后跳转到其他页面
            else:
                print('user')  # None
                print(type(user))  # <class 'NoneType'>
                error_msg = "用户名或密码错误"
            return render(request, "app/login.html", {"error_msg": error_msg})
    
    
    def sitelogout(request):
        logout(request)
        return redirect('/app')



登录模板文件login.html代码


    <div class="container">
        <form class="form-signin" method="post">
            {% csrf_token %}
            <h2 class="form-signin-heading">Please sign in</h2>
            <label for="username" class="sr-only">Username</label>
            <input type="text" id="username" class="form-control" name="username" placeholder="username" required="" autofocus="">
            <label for="inputPassword" class="sr-only">Password</label>
            <input type="password" id="inputPassword" class="form-control" name="password" placeholder="Password" required="">
            <div><span STYLE="color: red">{{ error_msg }}</span></div>
            <button class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button>
        </form>

    </div> <!-- /container -->

    <!-- 当前站点CSS样式文件 -->
    <link href="{% static 'signin.css' %}" rel="stylesheet">


登出链接就很简单了

    <a href="{% url 'logout' %}">Logout</a>


然后就可以运行Django进行测试了